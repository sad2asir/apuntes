import{_ as i,a as d}from"./Java_Stream_Readers_BufferedReaders-a4e1bc0d.js";import{_ as u,r as l,o as y,c as m,b as e,a as s,w as o,d as a,e as r}from"./app-7eaa5ff0.js";const v={},b=s("h1",{id:"_2-3-gestion-de-la-e-s-de-un-proceso",tabindex:"-1"},"2.3 Gestión de la E-S de un proceso",-1),E={class:"table-of-contents"},h=s("h2",{id:"_2-3-1-redireccion-de-la-e-s-estandar",tabindex:"-1"},"2.3.1 Redirección de la E/S estándar",-1),g=s("p",null,"Ya hemos comentado que un subproceso no tiene terminal o consola en el que poder mostrar su información. Toda la E/S por defecto ((stdin - teclado -, stdout y stderr - pantalla- ) por defecto se redirige al proceso padre. Es el proceso padre el que puede usar estos streams para recoger o enviar información al proceso hijo.",-1),f=s("div",{class:"custom-container danger"},[s("p",{class:"custom-container-title"},"Código del proceso hijo"),s("p",null,"En ningún momento, cuando estamos programando un proceso, debemos pensar si va a ser lanzado como padre o como hijo."),s("p",null,"Es más, todos los programas que hacemos son lanzados como hijos por el IDE (Netbeans) y eso no hace que cambiemos nuestra forma de programarlos."),s("p",null,"Un proceso que vayamos a lanzar como hijo debería funcionar perfectamente como proceso independiente y puede ser ejecutado directamente sin tener que hacerle ningún tipo de cambio.")],-1),q=s("p",null,"Este intercambio de información nos da mucha flexibilidad y proporciona una forma de control y comunicación sobre el proceso hijo.",-1),D={class:"custom-container info"},F=r(`<p class="custom-container-title">La E/S en el SO y las tuberías</p><p>La E/S en sistemas Linux, como casi todo lo demás, es tratada como un fichero.</p><p>Dentro de cada proceso, cuando se accede a un fichero, se le asigna un identificador único. Hay tres identificadores que se crean y se abren con la creación del proceso, y que además siempre tienen el mismo identificador:</p><ul><li>0: stdin</li><li>1: stdout</li><li>2: stderr</li></ul><p>Estos <em>descriptores de fichero</em> permiten gestionar sus streams asociados de diferentes formas. Podemos redirigir la salida de un proceso (stdout) a un archivo y seguir viendo los mensajes de error (stderr) en la consola, o bien podemos hacer que la entrada de datos a un programa se lea desde un fichero en vez del teclado, lo que permitiría automatizar pruebas, por ejemplo.</p><p>Estos son algunos ejemplos de cómo se hacen estas redirecciones a nivel de So:</p><div class="language-bash" data-ext="sh"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># Redirecciona la salida de ls a un archivo</span></span>
<span class="line"><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">capture.txt</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># Redirecciona la salida de ls a la entrada de cat (doble redirección)</span></span>
<span class="line"><span style="color:#6A737D;"># Esto es una tubería</span></span>
<span class="line"><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">cat</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6A737D;"># Cambia la salida de program.sh a capture.txt y los errores a error.txt</span></span>
<span class="line"><span style="color:#6F42C1;">./program.sh</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">1&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">capture.txt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">2&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error.txt</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;"># Redirige la salida y los errores de program.sh al mismo archivo, capture.txt</span></span>
<span class="line"><span style="color:#6F42C1;">./program.sh</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">capture.txt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#6A737D;"># Cambia la entrada de program.sh al contenido de dummy.txt</span></span>
<span class="line"><span style="color:#6F42C1;">./program.sh</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dummy.txt</span></span>
<span class="line"><span style="color:#6A737D;"># Redirige la salida del primer comando y la pone como entrada del segundo</span></span>
<span class="line"><span style="color:#6A737D;"># Esto es una tubería</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dummy.txt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">./program.sh</span></span>
<span class="line"></span></code></pre></div>`,7),A={href:"https://www.digitalocean.com/community/tutorials/an-introduction-to-linux-i-o-redirection",target:"_blank",rel:"noopener noreferrer"},C=r('<p>En la relación padre-hijo que se crea entre procesos los descriptores también se redirigen desde ek hijo hacia el padre, usando 3 tuberías (pipes), una por cada stream de E/S por defecto. Esas tuberías pueden usarse de forma similar a cómo se hace en los sistemas Linux.</p><p><img src="'+i+`" alt="alt_text"></p><h3 id="getinputstream" tabindex="-1">getInputStream()</h3><p>No sólo es importante recoger el valor de retorno de un comando, sino que muchas veces nos va a ser de mucha utilidad el poder obtener la información que el proceso genera por la salida estándar o por la salida de error.</p><p>Para esto vamos a utilizar el método <code>public abstract InputStream getInputStream()</code> de la clase <code>Process</code> para leer el stream de salida del proceso, es decir, para leer lo que el comando ejecutado (proceso hijo) ha enviado a la consola.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">Process p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pbuilder.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">BufferedReader processOutput </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BufferedReader</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InputStreamReader</span><span style="color:#24292E;">(p.</span><span style="color:#6F42C1;">getInputStream</span><span style="color:#24292E;">()));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">String linea;    </span></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> ((linea </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processOutput.</span><span style="color:#6F42C1;">readLine</span><span style="color:#24292E;">()) </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;&gt; &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> linea);        </span></span>
<span class="line"><span style="color:#24292E;">}            </span></span>
<span class="line"><span style="color:#24292E;">processOutput.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();    </span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+d+`" alt="alt_text"></p><div class="custom-container warning"><p class="custom-container-title">Charsets y encodings</p><p>Desde el inicio de la informática los juegos de caracteres y las codificaciones han supuesto un auténtico quebradero de cabeza para los programadores, especialmente cuando trabajamos con juegos de caracteres no anglosajones. Pues bien, la consola de Windows no iba a ser una excepción.</p><p>La consola de windows, conocida como <em>&quot;DOS prompt&quot;</em> o <em>cmd</em>, es la forma de ejecutar programas y comandos DOS en Windows, por lo tanto esos programas mantienen la codificación de DOS. A Microsoft no le gustan hacer cambios que pierdan la compatibilidad hacia atrás, es decir, que sean compatibles con versiones anteriores, así que cuando hagamos una aplicación que trabaje con la consola debemos tener en cuenta esta circunstancia.</p><p>En Wikipedia comentan que la codificación <strong>CP850</strong> teóricamente ha sido ampliamente reemplazada por <strong>Windows-1252</strong> y posteriormente Unicode, pero aún así <strong>CP850</strong> sigue presente en la consola de comandos.</p><p>Por lo tanto, si quetemos mostrar información de la consola en nuestras aplicaciones, debemos trabajar con el charset adecuado, a saber, CP-850.</p><p>Para usar un encoding concreto, la clase InputStreamReader, que pasa de gestionar bytes a caracteres, tiene un constructor que permite especificar el tipo de codificación usado en el stream de bytes que recibimos, así que que debemos usar este constructor cuando trabajemos con aplicaciones de consola.</p><div class="language-java" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InputStreamReader</span><span style="color:#24292E;">(p.</span><span style="color:#6F42C1;">getInputStream</span><span style="color:#24292E;">(), </span><span style="color:#032F62;">&quot;CP850&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span></code></pre></div><blockquote><p>Además, para usar una codificación universal, podemos forzar que Netbeans, o mejor dicho la máquina virtual que usa Netbeans, utilice <strong>por defecto el charset <code>UTF-8</code></strong>. Para hacerlo, debemos modificar el archivo de configuración de Netbeans <code>C:/Program Files/Netbeeans-xx.x/netbeans/etc/netbeans.conf</code>, y modificar la directiva <code>netbeans_default_option</code> añadiendo al final <strong>-J-Dfile.encoding=UTF-8</strong>.</p></blockquote></div><h3 id="geterrorstream" tabindex="-1">getErrorStream()</h3><p>Curiosamente, o no tanto, además de la salida estándar, también podemos obtener la salida de error (stderr) que genera el proceso hijo para procesarla desde el padre.</p><p>Si la salida de error ha sido previamente redirigida usando el método <code>ProcessBuilder.redirectErrorStream(true)</code> entonces la salida de error y la salida estándar llegan juntas con getInputStream() y no es necesario hacer un tratamiento adicional.</p><p>Si por el contrario queremos hacer un tratamiento diferenciado de los dos tipos de salid, podemos usar un schema similar al usado anteriormente, con la salvedad de que ahora en vez du llamar a <code>getInputStream()</code> lo hacemos con <code>getErrorStream()</code>.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">Process p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pbuilder.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">BufferedReader processError </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BufferedReader</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InputStreamReader</span><span style="color:#24292E;">(p.</span><span style="color:#6F42C1;">getErrorStream</span><span style="color:#24292E;">()));</span></span>
<span class="line"><span style="color:#6A737D;">// En este ejemplo, por ver una forma diferente de recoger la información,</span></span>
<span class="line"><span style="color:#6A737D;">// en vez de leer todas las líneas que llegan, recogemos la primera línea</span></span>
<span class="line"><span style="color:#6A737D;">// y suponemos que nos han enviado un entero.    </span></span>
<span class="line"><span style="color:#D73A49;">int</span><span style="color:#24292E;"> value </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Integer.</span><span style="color:#6F42C1;">parseInt</span><span style="color:#24292E;">(processError.</span><span style="color:#6F42C1;">readLine</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">processError.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13),j={class:"custom-container info"},S=s("p",{class:"custom-container-title"},"Patrón de diseño Decorator o Wrapper",-1),P=s("p",null,"En ambos tipos de streams de entrada (input y error) estamos recogiendo la información de un objeto de tipo BufferedReader. Podríamos usar directamente el InputStream que nos devuelven los métodos de Process, pero tendríamos que encargarnos nosotros de convertir los bytes a caracteres, de leer el stream caracter a caracter y de controlar el flujo al no disponer de un buffer.",-1),_=s("p",null,[a("Todo esto nos lo podemos ahorrar usando clases que gestionan el flujo a un nivel de concreción más alto, usando sin llegar a ser conscientes otro patrón de diseño bastante común, "),s("strong",null,"Patrón de diseño Decorator"),a(" también llamado "),s("strong",null,"wrapper o envoltorio"),a(".")],-1),x=s("blockquote",null,[s("p",null,"Decorator es un patrón de diseño estructural que te permite añadir funcionalidades a objetos colocando estos objetos dentro de objetos encapsuladores especiales que contienen estas funcionalidades.")],-1),I={href:"https://refactoring.guru/design-patterns/java",target:"_blank",rel:"noopener noreferrer"},k=r(`<p>Vamos a ver un ejemplo completo de uso de todas las funcionalidad anteriores</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> java.io.</span><span style="color:#005CC5;">*</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Ejercicio2</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        String comando </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;notepad&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        ProcessBuilder pbuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ProcessBuilder</span><span style="color:#24292E;"> (comando);</span></span>
<span class="line"><span style="color:#24292E;">        Process p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> pbuilder.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 1- Procedemos a leer lo que devuelve el proceso hijo</span></span>
<span class="line"><span style="color:#24292E;">            InputStream is </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> p.</span><span style="color:#6F42C1;">getInputStream</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 2- Lo convertimos en un InputStreamReader</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// De esta forma podemos leer caracteres en vez de bytes</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// El InputStreamReader nos permite gestionar diferentes codificaciones</span></span>
<span class="line"><span style="color:#24292E;">            InputStreamReader isr </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InputStreamReader</span><span style="color:#24292E;">(is);</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 2- Para mejorar el rendimiento hacemos un wrapper sobre un BufferedReader</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// De esta forma podemos leer enteros, cadenas o incluso líneas.</span></span>
<span class="line"><span style="color:#24292E;">            BufferedReader br </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BufferedReader</span><span style="color:#24292E;">(isr);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// A Continuación leemos todo como una cadena, línea a línea</span></span>
<span class="line"><span style="color:#24292E;">            String linea;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">while</span><span style="color:#24292E;"> ((linea </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> br.</span><span style="color:#6F42C1;">readLine</span><span style="color:#24292E;">()) </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">) </span></span>
<span class="line"><span style="color:#24292E;">                System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(linea);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (Exception </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Error en: &quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">comando);</span></span>
<span class="line"><span style="color:#24292E;">            e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// Para finalizar, cerramos los recursos abiertos</span></span>
<span class="line"><span style="color:#24292E;">            br.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            isr.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            is.</span><span style="color:#6F42C1;">close</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }    </span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><div class="highlight-line"> </div><br><br><br><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="getoutputstream" tabindex="-1">getOutputStream()</h3><p>No sólo podemos recoger la información que envía el proceso hijo sino que, además, también podemos enviar información desde el proceso padre al proceso hijo, usando el último de los tres streams que nos queda, el <code>stdin</code>.</p><p>Igual que con las entradas que llegan desde el proceso hijo, podemos enviar la información usando directamente el OutputStream del proceso, pero lo haremos de nuevo con un Decorator.</p><p>En este caso, el <em>wrapper</em> de mayor nivel nivel para usar un OutputStream es la clase PrintWriter que nos ofrece métodos similares a los de <code>System.out.printxxxxx</code> para gestionar el flujo de comunicación con el proceso hijo.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">PrintWriter toProcess </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PrintWriter</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">BufferedWriter</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">OutputStreamWriter</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">            p.</span><span style="color:#6F42C1;">getOutputStream</span><span style="color:#24292E;">(), </span><span style="color:#032F62;">&quot;UTF-8&quot;</span><span style="color:#24292E;">)), </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">toProcess.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;sent to child&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line"> </div><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="heredar-la-e-s-del-proceso-padre" tabindex="-1">Heredar la E/S del proceso padre</h3><p>Con el método <code>inheritIO()</code> podemos redireccionar todos los flujos de E/S del proceso hijo a la E/S estándar del proceso padre.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">ProcessBuilder processBuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ProcessBuilder</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;echo hello&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">processBuilder.</span><span style="color:#6F42C1;">inheritIO</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">Process process </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processBuilder.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">int</span><span style="color:#24292E;"> exitCode </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> process.</span><span style="color:#6F42C1;">waitFor</span><span style="color:#24292E;">();</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>En el ejemplo anterior, tras invocar al método inheritIO() podemos ver la salida del comando ejecutado en la consola del proceso padre dentro del IDE Netbeans.</p><h3 id="pipelines" tabindex="-1">Pipelines</h3><p>Java 9 introdujo el concepto de <code>pipelines</code> en el API de ProcessBuilder:</p><div class="language-java" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> List</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">Process</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> startPipeline​(List</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">ProcessBuilder</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> builders)</span></span>
<span class="line"></span></code></pre></div><p>El método <code>startPipeline</code> usa un lista de objetos ProcessBuilder. Este método estático se encarga de lanzar un proceso para cada uno de los ProcessBuilder recibidos. Y lo que automatiza es la creación de tuberías encadenadas (pipeline) haciendo que la salida de cada proceso esté enlazada con la entrada del siguiente..</p><p>Por ejemplo, si queremos realizar este tipo de operaciones tan comunes en shellscript:</p><blockquote><p>find . -name *.java -type f | wc -l</p></blockquote><p>Lo que haremos será crear un ProcessBuilder para cada uno de los comandos, y pasárselos todos al método startPipeline para que los ejecute y los encadene.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">List builders </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Arrays.</span><span style="color:#6F42C1;">asList</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ProcessBuilder</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;find&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;src&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-name&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;*.java&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-type&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;f&quot;</span><span style="color:#24292E;">), </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ProcessBuilder</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;wc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-l&quot;</span><span style="color:#24292E;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">List processes </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ProcessBuilder.</span><span style="color:#6F42C1;">startPipeline</span><span style="color:#24292E;">(builders);</span></span>
<span class="line"><span style="color:#24292E;">Process last </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processes.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(processes.</span><span style="color:#6F42C1;">size</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// Desde el proceso padre podemos recoger la salida del último proceso para </span></span>
<span class="line"><span style="color:#6A737D;">// el resultado final del pipeline</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>El ejemplo anterior busca todos los archivos .java dentro del directorio src, encadena la salida hacia el comando wc para contar cuantos ficheros ha encontrado, siendo este el resultado final del pipeline.</p><h2 id="_2-3-2-redireccion-de-las-entradas-y-salidas-estandar" tabindex="-1">2.3.2 Redirección de las Entradas y Salidas Estándar</h2><p>En un sistema real, probablemente necesitemos guardar los resultados de un proceso en un archivo de log o de errores para su posterior análisis. Afortunadamente lo podemos hacer sin modificar el código de nuestras aplicaciones usando los métodos que proporciona el API de ProcessBuilder para hacer exactamente eso.</p><p>Por defecto, tal y como ya hemos visto, los procesos hijos reciben la entrada a través de una tubería a la que podemos acceder usando el OutputStream que nos devuelve <code>Process.getOutputStream()</code>.</p><p>Sin embargo, tal y como veremos a continuación, esa entrada estándar se puede cambiar y redirigirse a otros destinos como un fichero usando el método <code>redirectOutput(File)</code>. Si modificamos la salida estándar, el método getOutputStream() devolverá <em>ProcessBuilder.NullOutputStream</em>.</p><div class="custom-container info"><p class="custom-container-title">Redirección antes de ejecutar</p><p>Es importante fijarse en qué momento se realiza cada acción sobre un proceso.</p><p>Antes hemos visto que los flujos de E/S se consultan y gestionan una vez que el proceso está en ejecución, por lo tanto los méotodos que nos dan acceso a esos <em>streams</em> son métodos de la clase <code>Process</code>.</p><p>Si lo que queremos es redirigir la E/S, como vamos a ver a continuación, lo haremos mientras preparamos el proceso para ser ejecutado. De forma que cuando se lance sus streams de E/S se modifiquen. Por eso en esta ocasión los métodos que nos permiten redireccionar la E/S de los procesos son métodos de la clase <code>ProcessBuilder</code>.</p></div><p>Vamos a ver con un ejemplo cómo hacer un programa que muestre la versión de Java. Ahora bien, en esta ocasión la salida se va a guardar en un archivo de log en vez de enviarla al padre por la tubería de salida estándar:</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">ProcessBuilder processBuilder </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ProcessBuilder</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;java&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-version&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// La salida de error se enviará al mismo sitio que la estándar</span></span>
<span class="line"><span style="color:#24292E;">processBuilder.</span><span style="color:#6F42C1;">redirectErrorStream</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">File log </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> folder.</span><span style="color:#6F42C1;">newFile</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;java-version.log&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">processBuilder.</span><span style="color:#6F42C1;">redirectOutput</span><span style="color:#24292E;">(log);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Process process </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processBuilder.</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line"> </div><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>En el ejemplo anterior podemos observar como se crea un archivo temporal llamado <em>java-version.log</em> e indicamos a ProcessBuilder que la salida la redirija a este archivo.</p><p>Es lo mismo que si llamásemos a nuestra aplicacion usando el operador de redirección de salida:</p><blockquote><p>java ejemplo-java-version &gt; java-version.log</p></blockquote><p>Ahora vamos a fijarnos en una variación del ejemplo anterior. Lo que queremos hacer ahora es añadir (<code>append to</code>) información al archivo de log file en vez de sobreescribir el archivo cada vez que se ejecuta el proceso. Con sobreeescribir nos referimos a crear el archivo vacío si no existe, o bien borrar el contenido del archivo si éste ya existe.</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">File log </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> tempFolder.</span><span style="color:#6F42C1;">newFile</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;java-version-append.log&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">processBuilder.</span><span style="color:#6F42C1;">redirectErrorStream</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">processBuilder.</span><span style="color:#6F42C1;">redirectOutput</span><span style="color:#24292E;">(Redirect.</span><span style="color:#6F42C1;">appendTo</span><span style="color:#24292E;">(log));</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Otra vez más, es importante hacer notar la llamada a <code>redirectErrorStream(true)</code>. En el caso de que se produzca algún error, se mezclarán con los mensajes de salida en el fichero..</p><p>En el APi de ProcessBuilder encontramos métodos para redireccionar también la salida de error estándar y la entrada estándar de los procesos.</p><ul><li>redirectError(File)</li><li>redirectInput(File)</li></ul><p>Para hacer las redirecciones también podemos utilizar la clase <code>ProcessBuilder.Redirect</code> como parámetro para los métodos anteriores, utilizando uno de los siguientes valores</p><table><thead><tr><th>Valor</th><th>Significado</th></tr></thead><tbody><tr><td>Redirect.DISCARD</td><td>La información se descarta</td></tr><tr><td>Redirect.to(File)</td><td>La información se guardará en el fichero indicado. Si existe, se vacía.</td></tr><tr><td>Redirect.from(File)</td><td>La información se leerá del fichero indicado</td></tr><tr><td>Redirect.appendTo(File)</td><td>La información se añadirá en el fichero indicado. Si existe, no se vacía</td></tr></tbody></table><h2 id="_2-3-3-informacion-de-los-procesos-en-java" tabindex="-1">2.3.3 Información de los procesos en Java</h2><p>Una vez que un proceso está en ejecución podemos obtener información acerca de ese proceso usando los métodos de la clase <code>java.lang.ProcessHandle.Info</code>:</p><ul><li>el comando usado para lanzar el proceso</li><li>Los argumentos/parámetros que recibió el proceso</li><li>El instante de tiempo en el que se inició el proceso</li><li>El tiempo de CPU que ha usado el proceso y el usuario que lo ha lanzado</li></ul><p>Aquí tenemos un sencillo ejemplo de cómo hacerlo</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">ProcessHandle processHandle </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ProcessHandle.</span><span style="color:#6F42C1;">current</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">ProcessHandle.Info processInfo </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processHandle.</span><span style="color:#6F42C1;">info</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;PID: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> processHandle.</span><span style="color:#6F42C1;">pid</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Arguments: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> processInfo.</span><span style="color:#6F42C1;">arguments</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Command: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> processInfo.</span><span style="color:#6F42C1;">command</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Instant: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> processInfo.</span><span style="color:#6F42C1;">startInstant</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Total CPU duration: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> processInfo.</span><span style="color:#6F42C1;">totalCpuDuration</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;User: &quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> processInfo.</span><span style="color:#6F42C1;">user</span><span style="color:#24292E;">());</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>En el ejemplo anterior hemos obtenido la información del proceso actual (<code>ProcessHandle.current()</code>), así que si estamos en el proceso padre, sólo podemos mostrar su información, pero no la de su hijo.</p><p>También es posible acceder a la información de un proceso lanzado (proceso hijo). En este caso necesitamos la instancia de <code>java.lang.Process</code> para llamar a su método <code>toHandle()</code> y obtener la instancia de <code>java.lang.ProcessHandle</code> del proceso hijo..</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="shiki github-light" style="background-color:#fff;" tabindex="0"><code><span class="line"><span style="color:#24292E;">Process process </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processBuilder.</span><span style="color:#6F42C1;">inheritIO</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">ProcessHandle childProcessHandle </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> process.</span><span style="color:#6F42C1;">toHandle</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">ProcessHandle.Info child processInfo </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> processHandle.</span><span style="color:#6F42C1;">info</span><span style="color:#24292E;">();</span></span>
<span class="line"></span></code></pre><div class="highlight-lines"><br><div class="highlight-line"> </div><div class="highlight-line"> </div></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A partir de ahí, el código para acceder a la información y detalles del proceso hijo es idéntico al ejemplo anterior.</p>`,46);function B(w,R){const c=l("DownloadPDF-component"),t=l("DocumentCover-component"),n=l("router-link"),p=l("ExternalLinkIcon");return y(),m("div",null,[e(c),e(t,{titulo:"2.3 Gestión de la E-S de un proceso"}),b,s("nav",E,[s("ul",null,[s("li",null,[e(n,{to:"#_2-3-1-redireccion-de-la-e-s-estandar"},{default:o(()=>[a("2.3.1 Redirección de la E/S estándar")]),_:1}),s("ul",null,[s("li",null,[e(n,{to:"#getinputstream"},{default:o(()=>[a("getInputStream()")]),_:1})]),s("li",null,[e(n,{to:"#geterrorstream"},{default:o(()=>[a("getErrorStream()")]),_:1})]),s("li",null,[e(n,{to:"#getoutputstream"},{default:o(()=>[a("getOutputStream()")]),_:1})]),s("li",null,[e(n,{to:"#heredar-la-e-s-del-proceso-padre"},{default:o(()=>[a("Heredar la E/S del proceso padre")]),_:1})]),s("li",null,[e(n,{to:"#pipelines"},{default:o(()=>[a("Pipelines")]),_:1})])])]),s("li",null,[e(n,{to:"#_2-3-2-redireccion-de-las-entradas-y-salidas-estandar"},{default:o(()=>[a("2.3.2 Redirección de las Entradas y Salidas Estándar")]),_:1})]),s("li",null,[e(n,{to:"#_2-3-3-informacion-de-los-procesos-en-java"},{default:o(()=>[a("2.3.3 Información de los procesos en Java")]),_:1})])])]),h,g,f,q,s("div",D,[F,s("p",null,[s("a",A,[a("Redirecciones E/S en Linux"),e(p)])])]),C,s("div",j,[S,P,_,x,s("p",null,[s("a",I,[a("Refactoring.Guru patrones de diseño"),e(p)])])]),k])}const O=u(v,[["render",B],["__file","iostreams.html.vue"]]);export{O as default};
